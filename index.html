<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <title>WeUI</title>
    <link rel="stylesheet" href="./style/weui.css" />
    <link rel="stylesheet" href="./example.css" />
    <link rel="stylesheet" href="./ico.css" />
</head>

<body ontouchstart>
    <div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>

    <div class="container" id="container"></div>

    <script type="text/html" id="tpl_home">
        <div class="page">
            <div class="page__hd">

                <center>
                    <a><img src="./images/1.jpg" style="width:100px" /></a>
                    <h4>客服微信：leo20160601</h4>
                </center>

            </div>
            <div class="page__hd">

                <!--<a href="javascript:" class="weui-btn weui-btn_primary">点击展现searchBar</a>-->
                <div class="weui-search-bar" id="searchBar">
                    <div class="weui-search-bar__form">
                        <div class="weui-search-bar__box">
                            <i class="weui-icon-search"></i>
                            <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required/>
                            <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
                        </div>
                        <label class="weui-search-bar__label" id="searchText">
                    <i class="weui-icon-search"></i>
                    <span>搜索</span>
                </label>
                    </div>
                    <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
                </div>
                <div class="button-sp-area">
                    <a href="?index=1" class="weui-btn weui-btn_mini weui-btn_default">A盘</a>
                    <a href="?index=2" class="weui-btn weui-btn_mini weui-btn_default">B盘</a>
                    <a href="?index=3" class="weui-btn weui-btn_mini weui-btn_default">C盘</a>
                </div>

                <div class="weui-cells" id="list"></div>
            </div>
        </div>


    </script>



    <script src="./zepto.min.js"></script>
    <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js"></script>
    <script src="./example.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        var URL = "http://127.0.0.1:8080"


        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = decodeURI(window.location.search).substr(1).match(reg);
            if (r != null)
                return unescape(r[2]);
            return null;
        }

        function dir() {
            var type = GetQueryString('type') ? GetQueryString('type') : 1;
            var params = ""
            var index = GetQueryString('index') ? GetQueryString('index') : 1;
            params = "?index=" + index
            if (type == 1) {
                params += "&type=1" + (GetQueryString('url') ? ("&url=" + GetQueryString('url')) : "")
            }

            if (type == 2) {
                params += "&type=2" + (GetQueryString('key') ? "&key=" + GetQueryString('key') : "")
            }
            axios.get(URL + '/spiderpan' + params)
                .then(function(response) {
                    var listTmpl = '<div class="weui-cell  weui-cell_example"><div class="weui-cell__hd"><span class="#image#" alt=""></span></div><div class="weui-cell__bd"><a href="#url#">#name#</a></div></div>',
                        $list = $("#list");
                    var data = response.data.data;
                    var index = GetQueryString('index') ? GetQueryString('index') : 1;
                    for (var i = 0; i < data.length; ++i) {
                        var str1 = listTmpl.replace('#image#', data[i]['format']);
                        var str2 = str1.replace('#name#', data[i]['name']);
                        var str3 = str2.replace('#url#', "?index=" + index + "&type=1&url=" + data[i]['url']);
                        $list.append(str3);
                    }
                })
                .catch(function(error) {
                    console.log(error);
                });
        }


        // alert(GetQueryString('pan'))

        dir()
    </script>
    <script type="text/javascript">
        $(function() {
            var $searchBar = $('#searchBar'),
                $searchResult = $('#searchResult'),
                $searchText = $('#searchText'),
                $searchInput = $('#searchInput'),
                $searchClear = $('#searchClear'),
                $searchCancel = $('#searchCancel');


            function hideSearchResult() {
                $searchResult.hide();
                $searchInput.val('');

            }

            function cancelSearch() {
                hideSearchResult();
                $searchBar.removeClass('weui-search-bar_focusing');
                $searchText.show();
            }

            function to(v) {
                var index = GetQueryString('index')
                window.location.href = "index.html?index=" + index + "&type=2&key=" + v
            }
            $searchText.on('click', function() {
                $searchBar.addClass('weui-search-bar_focusing');
                $searchInput.focus();
            });
            $searchInput
                .on('blur', function() {
                    if (!this.value.length) cancelSearch();
                })
                .on('keydown', function(event) {
                    if (event.keyCode == 13) {
                        to(this.value)

                    }

                })

            $searchClear.on('click', function() {
                hideSearchResult();
                $searchInput.focus();
            });
            $searchCancel.on('click', function() {
                cancelSearch();
                $searchInput.blur();
            });
        });
    </script>

</body>

</html>